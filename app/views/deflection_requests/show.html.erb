<h1 class="section-title">Оставить заявку</h1>
<p class="subtle">
  ID заявки: <%= @deflection_request.id %>
  <% if @deflection_request.result_mm.present? %> · Результат расчёта (мм): <%= @deflection_request.result_mm %><% end %>
</p>

<div class="card" style="margin:14px 0; grid-template-columns: 1fr;">
  <div class="card__row" style="justify-content:space-between; align-items:center;">
    <div>
      <div class="subtle" style="margin-bottom:6px;">Заказчик</div>
      <%= text_field_tag :customer_name,
                         (@deflection_request.requester&.email || ""),
                         class: "inp", placeholder: "Имя заказчика" %>
    </div>

    <div class="card__row">
      <%= link_to "К выбору", beam_types_path, class: "btn btn--outline" %>
      <%= button_to "Удалить заявку",
                    delete_deflection_request_path(@deflection_request.id),
                    method: :post,
                    data: {confirm: "Удалить черновик заявки?"},
                    class: "btn btn--danger" %>
    </div>
  </div>
</div>

<div class="cart-items">

  <% (@items || []).each do |item| %>
    <% bt = item.beam_type %>
    <article class="card">
      <%= image_tag image_url_for(bt.image_key), class: "thumb", alt: bt.name %>
      <div class="cart-toolbar">
        <div>
          <div class="card__title"><%= bt.name %></div>
          <div class="card__meta">
            Материал: <%= bt.material %> · Модуль E: <%= bt.elasticity_gpa %> ГПа · Норма: <%= bt.norm %>
          </div>

          <div class="card__row">
            <label class="subtle">Длина, м</label>
              <% value_len  = item[:length_m].presence  || 3.0 %>
              <% value_load = item[:load_kn_m].presence || 10.0 %>

              <%= number_field_tag "items[#{bt.id}][length_m]",  value_len,  step: 0.1, min: 0.5, class: "inp" %>
              <%= number_field_tag "items[#{bt.id}][load_kn_m]", value_load, step: 0.1, min: 0.5, class: "inp" %>


              <span class="subtle">× <%= item.quantity || 1 %></span>
          </div>
        </div>
      </div>
    </article>
  <% end %>

</div>

